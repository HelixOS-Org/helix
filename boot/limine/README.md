# Helix Limine - Industrial-Grade Limine Protocol Implementation

<div align="center">

**๐ The Reference Implementation of Limine Protocol in Rust**

*Zero-copy โข Type-safe โข SMP-ready โข Production-grade*

</div>

---

## ๐ Table of Contents

1. [Vision](#vision)
2. [Architecture Overview](#architecture-overview)
3. [Module Structure](#module-structure)
4. [Memory Model](#memory-model)
5. [CPU Topology](#cpu-topology)
6. [Boot Sequence](#boot-sequence)
7. [API Reference](#api-reference)
8. [Safety Model](#safety-model)

---

## Vision

This implementation aims to be the **definitive Limine protocol implementation in Rust**,
providing:

- **Complete Protocol Coverage**: Every Limine request type implemented
- **Type Safety**: Strong typing with compile-time guarantees
- **Zero-Copy Parsing**: No allocations during boot
- **SMP Support**: Full multi-processor initialization
- **Memory Safety**: Minimal unsafe, maximum verification
- **Extensibility**: Designed for future protocol versions

---

## Architecture Overview

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                           HELIX LIMINE ARCHITECTURE                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                      LAYER 4: BOOT ABSTRACTION                          โ   โ
โ  โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ    โ   โ
โ  โ  โ  BootInfo   โ  โ MemoryModel โ  โ CpuTopology โ  โ   Console   โ    โ   โ
โ  โ  โ  (unified)  โ  โ  (virtual)  โ  โ   (SMP)     โ  โ (framebuf)  โ    โ   โ
โ  โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ    โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                        โ                                        โ
โ                                        โผ                                        โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                     LAYER 3: SAFE ABSTRACTIONS                          โ   โ
โ  โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โ   โ
โ  โ  โ MemoryMap    โ  โ Framebuffer  โ  โ SmpRequest   โ  โ  Modules   โ  โ   โ
โ  โ  โ Iterator     โ  โ Canvas       โ  โ Processor    โ  โ  Loader    โ  โ   โ
โ  โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โ   โ
โ  โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โ   โ
โ  โ  โ HHDM Access  โ  โ ACPI Tables  โ  โ DeviceTree   โ  โ  Paging    โ  โ   โ
โ  โ  โ Manager      โ  โ Parser       โ  โ Parser       โ  โ  Control   โ  โ   โ
โ  โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ  โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                        โ                                        โ
โ                                        โผ                                        โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                    LAYER 2: PROTOCOL RESPONSES                          โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ   โ
โ  โ  โ  ResponseParser<'boot>                                          โ   โ   โ
โ  โ  โ  โโโ BootloaderInfoResponse                                     โ   โ   โ
โ  โ  โ  โโโ StackSizeResponse                                          โ   โ   โ
โ  โ  โ  โโโ HhdmResponse                                               โ   โ   โ
โ  โ  โ  โโโ FramebufferResponse                                        โ   โ   โ
โ  โ  โ  โโโ PagingModeResponse                                         โ   โ   โ
โ  โ  โ  โโโ SmpResponse                                                โ   โ   โ
โ  โ  โ  โโโ MemoryMapResponse                                          โ   โ   โ
โ  โ  โ  โโโ EntryPointResponse                                         โ   โ   โ
โ  โ  โ  โโโ KernelFileResponse                                         โ   โ   โ
โ  โ  โ  โโโ ModuleResponse                                             โ   โ   โ
โ  โ  โ  โโโ RsdpResponse                                               โ   โ   โ
โ  โ  โ  โโโ SmbiosResponse                                             โ   โ   โ
โ  โ  โ  โโโ EfiSystemTableResponse                                     โ   โ   โ
โ  โ  โ  โโโ EfiMemoryMapResponse                                       โ   โ   โ
โ  โ  โ  โโโ BootTimeResponse                                           โ   โ   โ
โ  โ  โ  โโโ KernelAddressResponse                                      โ   โ   โ
โ  โ  โ  โโโ DeviceTreeBlobResponse                                     โ   โ   โ
โ  โ  โ  โโโ ... (all protocol responses)                               โ   โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                        โ                                        โ
โ                                        โผ                                        โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                     LAYER 1: PROTOCOL REQUESTS                          โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ   โ
โ  โ  โ  Static Request Structures (link_section = ".limine_requests")  โ   โ   โ
โ  โ  โ  โโโ BOOTLOADER_INFO_REQUEST                                    โ   โ   โ
โ  โ  โ  โโโ STACK_SIZE_REQUEST                                         โ   โ   โ
โ  โ  โ  โโโ HHDM_REQUEST                                               โ   โ   โ
โ  โ  โ  โโโ FRAMEBUFFER_REQUEST                                        โ   โ   โ
โ  โ  โ  โโโ PAGING_MODE_REQUEST                                        โ   โ   โ
โ  โ  โ  โโโ SMP_REQUEST                                                โ   โ   โ
โ  โ  โ  โโโ MEMORY_MAP_REQUEST                                         โ   โ   โ
โ  โ  โ  โโโ ENTRY_POINT_REQUEST                                        โ   โ   โ
โ  โ  โ  โโโ KERNEL_FILE_REQUEST                                        โ   โ   โ
โ  โ  โ  โโโ MODULE_REQUEST                                             โ   โ   โ
โ  โ  โ  โโโ RSDP_REQUEST                                               โ   โ   โ
โ  โ  โ  โโโ SMBIOS_REQUEST                                             โ   โ   โ
โ  โ  โ  โโโ EFI_SYSTEM_TABLE_REQUEST                                   โ   โ   โ
โ  โ  โ  โโโ EFI_MEMMAP_REQUEST                                         โ   โ   โ
โ  โ  โ  โโโ BOOT_TIME_REQUEST                                          โ   โ   โ
โ  โ  โ  โโโ KERNEL_ADDRESS_REQUEST                                     โ   โ   โ
โ  โ  โ  โโโ DTB_REQUEST                                                โ   โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                        โ                                        โ
โ                                        โผ                                        โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                      LAYER 0: RAW PROTOCOL                              โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ   โ
โ  โ  โ  limine-protocol (FFI definitions)                              โ   โ   โ
โ  โ  โ  โโโ Magic numbers, revision constants                          โ   โ   โ
โ  โ  โ  โโโ Raw struct definitions (#[repr(C)])                        โ   โ   โ
โ  โ  โ  โโโ Request/Response ID arrays                                 โ   โ   โ
โ  โ  โ  โโโ Linker section macros                                      โ   โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Module Structure

```
boot/limine/
โโโ Cargo.toml                      # Workspace crate manifest
โโโ README.md                       # This documentation
โ
โโโ src/
โ   โโโ lib.rs                      # Public API, re-exports
โ   โ
โ   โโโ protocol/                   # LAYER 0: Raw Protocol Definitions
โ   โ   โโโ mod.rs                  # Protocol module root
โ   โ   โโโ magic.rs                # Magic numbers, IDs, revisions
โ   โ   โโโ raw.rs                  # Raw FFI structures
โ   โ   โโโ request_ids.rs          # Request ID constants
โ   โ   โโโ macros.rs               # Request declaration macros
โ   โ
โ   โโโ requests/                   # LAYER 1: Request Structures
โ   โ   โโโ mod.rs                  # Request module root
โ   โ   โโโ bootloader_info.rs      # Bootloader info request
โ   โ   โโโ stack_size.rs           # Stack size request
โ   โ   โโโ hhdm.rs                 # Higher Half Direct Map request
โ   โ   โโโ framebuffer.rs          # Framebuffer request
โ   โ   โโโ paging.rs               # Paging mode request
โ   โ   โโโ smp.rs                  # SMP request
โ   โ   โโโ memory_map.rs           # Memory map request
โ   โ   โโโ entry_point.rs          # Entry point request
โ   โ   โโโ kernel_file.rs          # Kernel file request
โ   โ   โโโ module.rs               # Module request
โ   โ   โโโ rsdp.rs                 # ACPI RSDP request
โ   โ   โโโ smbios.rs               # SMBIOS request
โ   โ   โโโ efi.rs                  # EFI requests
โ   โ   โโโ boot_time.rs            # Boot time request
โ   โ   โโโ kernel_address.rs       # Kernel address request
โ   โ   โโโ dtb.rs                  # Device Tree Blob request
โ   โ
โ   โโโ responses/                  # LAYER 2: Response Parsing
โ   โ   โโโ mod.rs                  # Response module root
โ   โ   โโโ parser.rs               # Response parser engine
โ   โ   โโโ bootloader_info.rs      # Bootloader info response
โ   โ   โโโ hhdm.rs                 # HHDM response
โ   โ   โโโ framebuffer.rs          # Framebuffer response
โ   โ   โโโ paging.rs               # Paging mode response
โ   โ   โโโ smp.rs                  # SMP response + CPU info
โ   โ   โโโ memory_map.rs           # Memory map response
โ   โ   โโโ kernel_file.rs          # Kernel file response
โ   โ   โโโ module.rs               # Module response
โ   โ   โโโ rsdp.rs                 # RSDP response
โ   โ   โโโ smbios.rs               # SMBIOS response
โ   โ   โโโ efi.rs                  # EFI responses
โ   โ   โโโ boot_time.rs            # Boot time response
โ   โ   โโโ kernel_address.rs       # Kernel address response
โ   โ   โโโ dtb.rs                  # DTB response
โ   โ
โ   โโโ memory/                     # Memory Model Abstractions
โ   โ   โโโ mod.rs                  # Memory module root
โ   โ   โโโ region.rs               # Memory region types
โ   โ   โโโ map.rs                  # Memory map abstraction
โ   โ   โโโ hhdm.rs                 # HHDM access utilities
โ   โ   โโโ physical.rs             # Physical address type
โ   โ   โโโ virtual_addr.rs         # Virtual address type
โ   โ   โโโ paging.rs               # Paging control
โ   โ
โ   โโโ cpu/                        # CPU Topology
โ   โ   โโโ mod.rs                  # CPU module root
โ   โ   โโโ processor.rs            # Processor abstraction
โ   โ   โโโ smp.rs                  # SMP initialization
โ   โ   โโโ features.rs             # CPU feature detection
โ   โ   โโโ topology.rs             # CPU topology discovery
โ   โ   โโโ per_cpu.rs              # Per-CPU data structures
โ   โ
โ   โโโ framebuffer/                # Framebuffer Engine
โ   โ   โโโ mod.rs                  # Framebuffer module root
โ   โ   โโโ pixel.rs                # Pixel formats
โ   โ   โโโ canvas.rs               # Drawing canvas
โ   โ   โโโ font.rs                 # Built-in font
โ   โ   โโโ console.rs              # Text console
โ   โ   โโโ ops.rs                  # Drawing operations
โ   โ
โ   โโโ firmware/                   # Firmware Interfaces
โ   โ   โโโ mod.rs                  # Firmware module root
โ   โ   โโโ acpi.rs                 # ACPI table access
โ   โ   โโโ smbios.rs               # SMBIOS parsing
โ   โ   โโโ efi.rs                  # EFI runtime services
โ   โ   โโโ dtb.rs                  # Device Tree parsing
โ   โ
โ   โโโ file/                       # File Abstractions
โ   โ   โโโ mod.rs                  # File module root
โ   โ   โโโ kernel.rs               # Kernel file access
โ   โ   โโโ module.rs               # Boot module access
โ   โ
โ   โโโ boot_info.rs                # Unified BootInfo abstraction
โ   โโโ entry.rs                    # Entry point handling
โ   โโโ validate.rs                 # Validation & invariants
โ   โโโ error.rs                    # Error types
โ
โโโ examples/
    โโโ minimal_kernel.rs           # Minimal kernel example
    โโโ smp_kernel.rs               # SMP kernel example
```

---

## Memory Model

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                          LIMINE MEMORY MODEL                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                                 โ
โ  Virtual Address Space (with HHDM)                                              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                            โ
โ                                                                                 โ
โ  0xFFFF_8000_0000_0000 โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                        โ                                                    โ  โ
โ                        โ     Higher Half Direct Map (HHDM)                  โ  โ
โ                        โ     โโโโโโโโโโโโโโโโโโโโโโโโโโโโ                   โ  โ
โ                        โ                                                    โ  โ
โ                        โ     Physical memory is mapped 1:1 here             โ  โ
โ                        โ     phys_to_virt(addr) = HHDM_OFFSET + addr        โ  โ
โ                        โ     virt_to_phys(addr) = addr - HHDM_OFFSET        โ  โ
โ                        โ                                                    โ  โ
โ  0xFFFF_FFFF_8000_0000 โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค  โ
โ                        โ                                                    โ  โ
โ                        โ     Kernel Image                                   โ  โ
โ                        โ     โโโโโโโโโโโโ                                   โ  โ
โ                        โ                                                    โ  โ
โ                        โ     .text   (executable)                           โ  โ
โ                        โ     .rodata (read-only)                            โ  โ
โ                        โ     .data   (read-write)                           โ  โ
โ                        โ     .bss    (zero-initialized)                     โ  โ
โ                        โ                                                    โ  โ
โ  0xFFFF_FFFF_FFFF_FFFF โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โ                                                                                 โ
โ  Physical Memory Map                                                            โ
โ  โโโโโโโโโโโโโโโโโโโ                                                            โ
โ                                                                                 โ
โ  0x0000_0000 โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              โ  Legacy Region (0 - 1MB)                                       โโ
โ              โ  โโโ Real Mode IVT (0x0000 - 0x03FF)                           โโ
โ              โ  โโโ BDA (0x0400 - 0x04FF)                                     โโ
โ              โ  โโโ Reserved (0x0500 - 0x7BFF)                                โโ
โ              โ  โโโ Bootloader (0x7C00 - 0x7DFF)                              โโ
โ              โ  โโโ Extended BDA (0x80000 - 0x9FFFF)                          โโ
โ              โ  โโโ VGA Buffer (0xA0000 - 0xBFFFF)                            โโ
โ              โ  โโโ ROM (0xC0000 - 0xFFFFF)                                   โโ
โ  0x0010_0000 โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโคโ
โ              โ  Extended Memory (1MB+)                                        โโ
โ              โ  โโโ Kernel Image (loaded here)                                โโ
โ              โ  โโโ Boot Modules                                              โโ
โ              โ  โโโ Page Tables                                               โโ
โ              โ  โโโ Stack(s)                                                  โโ
โ              โ  โโโ Free Memory                                               โโ
โ  0xFFFF_FFFF โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  (4GB limit, โ                                                                 โ
โ   extends to โ  (Actual memory extends to physical memory limit)               โ
โ   ~TBs)      โ                                                                 โ
โ                                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## CPU Topology

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                           SMP INITIALIZATION FLOW                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                         BOOTSTRAP PROCESSOR (BSP)                        โ   โ
โ  โ                                                                          โ   โ
โ  โ  1. Limine loads kernel                                                  โ   โ
โ  โ  2. Limine sets up paging (HHDM)                                         โ   โ
โ  โ  3. Limine fills SMP response                                            โ   โ
โ  โ  4. Limine calls kernel entry point                                      โ   โ
โ  โ                                                                          โ   โ
โ  โ  kernel_main():                                                          โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ   โ
โ  โ  โ  // BSP initialization                                             โ โ   โ
โ  โ  โ  let smp = SMP_REQUEST.response()?;                                โ โ   โ
โ  โ  โ  let bsp = smp.bsp();                                              โ โ   โ
โ  โ  โ                                                                    โ โ   โ
โ  โ  โ  // Initialize BSP-specific data                                   โ โ   โ
โ  โ  โ  init_bsp_per_cpu_data(bsp);                                       โ โ   โ
โ  โ  โ                                                                    โ โ   โ
โ  โ  โ  // Start Application Processors                                   โ โ   โ
โ  โ  โ  for cpu in smp.cpus() {                                           โ โ   โ
โ  โ  โ      if !cpu.is_bsp() {                                            โ โ   โ
โ  โ  โ          cpu.start(ap_entry, per_cpu_stack);                       โ โ   โ
โ  โ  โ      }                                                             โ โ   โ
โ  โ  โ  }                                                                 โ โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                        โ                                        โ
โ                                        โผ                                        โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                    APPLICATION PROCESSORS (APs)                          โ   โ
โ  โ                                                                          โ   โ
โ  โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ               โ   โ
โ  โ  โ  CPU 1   โ  โ  CPU 2   โ  โ  CPU 3   โ  โ  CPU N   โ               โ   โ
โ  โ  โ          โ  โ          โ  โ          โ  โ          โ               โ   โ
โ  โ  โ ap_entry โ  โ ap_entry โ  โ ap_entry โ  โ ap_entry โ               โ   โ
โ  โ  โ    โ     โ  โ    โ     โ  โ    โ     โ  โ    โ     โ               โ   โ
โ  โ  โ    โผ     โ  โ    โผ     โ  โ    โผ     โ  โ    โผ     โ               โ   โ
โ  โ  โ init_ap  โ  โ init_ap  โ  โ init_ap  โ  โ init_ap  โ               โ   โ
โ  โ  โ    โ     โ  โ    โ     โ  โ    โ     โ  โ    โ     โ               โ   โ
โ  โ  โ    โผ     โ  โ    โผ     โ  โ    โผ     โ  โ    โผ     โ               โ   โ
โ  โ  โ  idle    โ  โ  idle    โ  โ  idle    โ  โ  idle    โ               โ   โ
โ  โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ               โ   โ
โ  โ                                                                          โ   โ
โ  โ  Per-CPU Data Structure:                                                 โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ   โ
โ  โ  โ  struct PerCpu {                                                   โ โ   โ
โ  โ  โ      cpu_id: u32,                                                  โ โ   โ
โ  โ  โ      lapic_id: u32,                                                โ โ   โ
โ  โ  โ      is_bsp: bool,                                                 โ โ   โ
โ  โ  โ      stack_top: VirtAddr,                                          โ โ   โ
โ  โ  โ      stack_size: usize,                                            โ โ   โ
โ  โ  โ      tss: TaskStateSegment,                                        โ โ   โ
โ  โ  โ      gdt: GlobalDescriptorTable,                                   โ โ   โ
โ  โ  โ      idt: InterruptDescriptorTable,                                โ โ   โ
โ  โ  โ      scheduler_data: SchedulerPerCpu,                              โ โ   โ
โ  โ  โ      // ...                                                        โ โ   โ
โ  โ  โ  }                                                                 โ โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Boot Sequence

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                           LIMINE BOOT SEQUENCE                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                                 โ
โ  Time    Event                                                                  โ
โ  โโโโ    โโโโโ                                                                  โ
โ                                                                                 โ
โ  T+0     Firmware (BIOS/UEFI) starts                                            โ
โ          โโโ POST, hardware init                                                โ
โ                                                                                 โ
โ  T+1     Limine bootloader loaded                                               โ
โ          โโโ From disk (MBR/GPT/EFI)                                            โ
โ                                                                                 โ
โ  T+2     Limine parses configuration                                            โ
โ          โโโ limine.conf                                                        โ
โ                                                                                 โ
โ  T+3     Limine loads kernel ELF                                                โ
โ          โโโ Parse ELF headers                                                  โ
โ          โโโ Load segments to memory                                            โ
โ          โโโ Locate .limine_requests section                                    โ
โ                                                                                 โ
โ  T+4     Limine processes requests                                              โ
โ          โโโ For each request in section:                                       โ
โ          โ   โโโ Validate magic number                                          โ
โ          โ   โโโ Check revision                                                 โ
โ          โ   โโโ Allocate response structure                                    โ
โ          โ   โโโ Fill response pointer                                          โ
โ          โ                                                                      โ
โ          โโโ HHDM setup                                                         โ
โ          โ   โโโ Map all physical memory to higher half                         โ
โ          โ                                                                      โ
โ          โโโ Framebuffer setup                                                  โ
โ          โ   โโโ Configure video mode                                           โ
โ          โ                                                                      โ
โ          โโโ Memory map creation                                                โ
โ          โ   โโโ Collect and sort memory regions                                โ
โ          โ                                                                      โ
โ          โโโ SMP preparation                                                    โ
โ              โโโ Enumerate and prepare CPUs                                     โ
โ                                                                                 โ
โ  T+5     Limine transfers control to kernel                                     โ
โ          โโโ Set up kernel stack                                                โ
โ          โโโ Enable paging (CR3)                                                โ
โ          โโโ Jump to entry point                                                โ
โ          โโโ Pass nothing (requests are static)                                 โ
โ                                                                                 โ
โ  T+6     Kernel entry (_start / kernel_main)                                    โ
โ          โโโ Verify boot environment                                            โ
โ          โโโ Parse responses                                                    โ
โ          โโโ Initialize BSP                                                     โ
โ          โโโ Set up memory management                                           โ
โ          โโโ Start APs (SMP)                                                    โ
โ          โโโ Continue to kernel init                                            โ
โ                                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Safety Model

### Unsafe Boundaries

```rust
// LAYER 0: Raw protocol (unsafe internals)
mod protocol {
    // All raw structs are repr(C), direct memory access
    // This is the ONLY place with raw pointer manipulation
}

// LAYER 1: Request declarations (safe macro wrappers)
mod requests {
    // Macros generate safe request structures
    // No unsafe user-facing code
}

// LAYER 2: Response parsing (single unsafe boundary)
mod responses {
    // ONE unsafe call: response pointer dereference
    // After that, everything is safe with lifetimes
}

// LAYER 3+: Pure safe Rust
mod memory { /* Safe abstractions */ }
mod cpu { /* Safe abstractions */ }
mod framebuffer { /* Safe abstractions */ }
```

### Lifetime Model

```rust
// Boot information is lifetime-bound
struct LimineBootInfo<'boot> {
    // All references are tied to 'boot lifetime
    memory_map: MemoryMap<'boot>,
    framebuffers: &'boot [Framebuffer<'boot>],
    // ...
}

// Prevents use-after-free by design
fn kernel_main() {
    let boot_info = unsafe { LimineBootInfo::from_responses() };
    // boot_info valid for 'static (boot data never freed)

    for region in boot_info.memory_map.regions() {
        // region is &'boot MemoryRegion
    }
}
```

---

## License

MIT OR Apache-2.0
